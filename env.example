# =============================================================================
# CopperMind v1.0.0 - Environment Configuration
# =============================================================================
# Copy this file to .env and fill in your values:
#   cp env.example .env
# =============================================================================

# -----------------------------------------------------------------------------
# Database (Supabase PostgreSQL)
# -----------------------------------------------------------------------------
# Supabase connection string:
DATABASE_URL=postgresql://postgres:YOUR_PASSWORD@db.xxxxx.supabase.co:5432/postgres

# -----------------------------------------------------------------------------
# Model Storage
# -----------------------------------------------------------------------------
MODEL_DIR=/data/models

# -----------------------------------------------------------------------------
# Pipeline Trigger Authentication (Required for public deployment)
# -----------------------------------------------------------------------------
# Secret token for POST /api/pipeline/trigger
# Generate a random 32+ character string. Do not commit real values.
PIPELINE_TRIGGER_SECRET=


# -----------------------------------------------------------------------------
# News Sources
# -----------------------------------------------------------------------------
# NewsAPI key (optional - if empty, RSS fallback is used)
# Get your key at: https://newsapi.org/
NEWSAPI_KEY=

# Search query for copper-related news
NEWS_QUERY=copper OR copper price OR copper futures OR copper mining

# Language filter (FinBERT is optimized for English)
NEWS_LANGUAGE=en

# -----------------------------------------------------------------------------
# Price Data (yfinance)
# -----------------------------------------------------------------------------
# Comma-separated symbols: HG=F (Copper), DX-Y.NYB (DXY), CL=F (Oil), FXI (China ETF)
YFINANCE_SYMBOLS=HG=F,DX-Y.NYB,CL=F,FXI

# How many days of historical data to fetch
LOOKBACK_DAYS=365

# -----------------------------------------------------------------------------
# Fuzzy Deduplication (RSS noise reduction)
# -----------------------------------------------------------------------------
# Similarity threshold (0-100) for fuzzy title matching
FUZZY_DEDUP_THRESHOLD=85

# Time window (hours) for fuzzy dedup comparison
FUZZY_DEDUP_WINDOW_HOURS=48

# -----------------------------------------------------------------------------
# Sentiment Aggregation
# -----------------------------------------------------------------------------
# Exponential decay half-life for recency weighting (hours)
SENTIMENT_TAU_HOURS=12

# Fill value for days with no news
SENTIMENT_MISSING_FILL=0.0

# Hybrid scoring aggressiveness controls
SENTIMENT_NON_NEUTRAL_BOOST=1.35
SENTIMENT_SOFT_NEUTRAL_POLARITY_THRESHOLD=0.12
SENTIMENT_SOFT_NEUTRAL_MAX_MAG=0.25
SENTIMENT_SOFT_NEUTRAL_SCALE=0.8

# V2 commodity-aware sentiment controls
SCORING_SOURCE=news_processed
SENTIMENT_RELEVANCE_MIN=0.35
SENTIMENT_ESCALATE_CONFLICT_THRESHOLD=0.55
SENTIMENT_HORIZON_DAYS=5

# -----------------------------------------------------------------------------
# API Settings
# -----------------------------------------------------------------------------
# Cache TTL for analysis snapshots (minutes)
ANALYSIS_TTL_MINUTES=30

# Logging level: DEBUG, INFO, WARNING, ERROR
LOG_LEVEL=INFO

# ---------------------------------------------------------------------------
# Inference Sentiment Adjustment (Aggressive v2)
# ---------------------------------------------------------------------------
INFERENCE_SENTIMENT_MULTIPLIER_MAX=2.0
INFERENCE_SENTIMENT_MULTIPLIER_MIN=0.5
INFERENCE_SENTIMENT_NEWS_REF=30
INFERENCE_SENTIMENT_POWER_REF=0.20
INFERENCE_TINY_SIGNAL_THRESHOLD=0.0015
INFERENCE_TINY_SIGNAL_FLOOR=0.0025
INFERENCE_RETURN_CAP=0.02

# -----------------------------------------------------------------------------
# Redis Queue (Worker)
# -----------------------------------------------------------------------------
# Redis URL for job queue (arq)
REDIS_URL=redis://localhost:6379/0

# -----------------------------------------------------------------------------
# Scheduler (DEPRECATED - Use GitHub Actions cron instead)
# -----------------------------------------------------------------------------
# These settings are no longer used in production.
# Pipeline scheduling is now external (GitHub Actions, Cloud Scheduler, etc.)
# The API only enqueues jobs; the Worker executes them.

# Daily pipeline run time (HH:MM format) - DEPRECATED
SCHEDULE_TIME=09:00

# Timezone for scheduler - DEPRECATED
TZ=Europe/Istanbul

# Enable/disable scheduler - DEPRECATED (default: false)
# Set to true only for local development without Redis
SCHEDULER_ENABLED=false

# -----------------------------------------------------------------------------
# OpenRouter AI Commentary (Optional)
# -----------------------------------------------------------------------------
# Get your free API key at: https://openrouter.ai/
OPENROUTER_API_KEY=

# Primary scoring model (must support response_format: json_object)
OPENROUTER_MODEL_SCORING=google/gemma-3n-e4b-it:free

# Fast model for initial scoring pass (V2 escalation pipeline)
OPENROUTER_MODEL_SCORING_FAST=google/gemma-3n-e4b-it:free

# Reliable fallback for escalated/conflicting articles
OPENROUTER_MODEL_SCORING_RELIABLE=nvidia/llama-nemotron-embed-vl-1b-v2:free

# Commentary model (structured output not required)
OPENROUTER_MODEL_COMMENTARY=nvidia/llama-nemotron-embed-vl-1b-v2:free

# Soft throttle and retry policy
OPENROUTER_RPM=18
OPENROUTER_MAX_RETRIES=3

# Run-level budget for LLM sentiment scoring (overflow falls back to FinBERT)
MAX_LLM_ARTICLES_PER_RUN=200

# Optional fallback models (comma-separated)
# Example: OPENROUTER_FALLBACK_MODELS=model-a,model-b
OPENROUTER_FALLBACK_MODELS=

# -----------------------------------------------------------------------------
# Backward Compatibility (Deprecated)
# -----------------------------------------------------------------------------
# These are still supported as fallbacks but should not be used for new setups.
OPENROUTER_MODEL=
LLM_SENTIMENT_MODEL=

# -----------------------------------------------------------------------------
# FinBERT/Transformers Logging
# -----------------------------------------------------------------------------
HF_HUB_DISABLE_PROGRESS_BARS=1
TRANSFORMERS_VERBOSITY=error
TRANSFORMERS_NO_ADVISORY_WARNINGS=1
TOKENIZERS_PARALLELISM=false
